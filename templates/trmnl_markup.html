<div style="
    width: 800px;
    height: 600px;
    background: #ffffff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-family: 'Times New Roman', 'Georgia', serif;
    color: #000000;
    padding: 40px;
    box-sizing: border-box;
    position: relative;
    overflow: hidden;
">
    
    
    <!-- Quote Text -->
    <blockquote id="quoteText" style="
        font-size: 36px;
        line-height: 1.3;
        margin: 0 0 30px 0;
        font-weight: 400;
        font-style: italic;
        color: #000000;
        font-family: 'Times New Roman', 'Georgia', serif;
        word-wrap: break-word;
        overflow-wrap: break-word;
        hyphens: auto;
        text-align: center;
        max-width: 700px;
    ">
        "{{ text }}"
    </blockquote>
    
    <!-- Author -->
    <div style="
        font-size: 20px;
        font-weight: 500;
        margin-bottom: 10px;
        color: #333333;
        font-family: 'Times New Roman', 'Georgia', serif;
        text-align: center;
    ">
        â€” {{ author }}
    </div>
    
    <!-- Source -->
    <div style="
        font-size: 16px;
        color: #666666;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: 'Times New Roman', 'Georgia', serif;
        text-align: center;
    ">
        {{ source }}
    </div>
    
    <!-- Footer -->
    <div style="
        position: absolute;
        bottom: 20px;
        right: 30px;
        font-size: 12px;
        color: #999999;
        z-index: 1;
        font-family: 'Times New Roman', 'Georgia', serif;
    ">
        TRMNL Quote Plugin
    </div>
    
    <!-- Refresh Indicator -->
    <div style="
        position: absolute;
        top: 20px;
        right: 30px;
        font-size: 12px;
        color: #999999;
        z-index: 1;
        font-family: 'Times New Roman', 'Georgia', serif;
    ">
        Auto-refresh: {{ refresh_interval_minutes }}m
    </div>
    
</div>

<script>
function adjustFontSize() {
    const quoteElement = document.getElementById('quoteText');
    const quoteText = quoteElement.textContent;
    const textLength = quoteText.length;
    
    // Available space calculations
    const containerWidth = 700; // max-width of quote text
    const containerHeight = 520; // approximate available height (600px - 80px padding)
    const availableWidth = containerWidth;
    const availableHeight = containerHeight - 100; // reserve space for author/source
    
    // Base font sizes for different quote lengths
    let baseFontSize;
    if (textLength <= 50) {
        baseFontSize = 36; // Short quotes - large font
    } else if (textLength <= 100) {
        baseFontSize = 32; // Medium quotes
    } else if (textLength <= 150) {
        baseFontSize = 28; // Longer quotes
    } else if (textLength <= 200) {
        baseFontSize = 24; // Very long quotes
    } else if (textLength <= 300) {
        baseFontSize = 20; // Extra long quotes
    } else {
        baseFontSize = 18; // Extremely long quotes
    }
    
    // Calculate optimal font size based on text dimensions
    const words = quoteText.split(' ');
    const avgWordsPerLine = Math.ceil(words.length / Math.ceil(textLength / 50));
    const estimatedLines = Math.ceil(words.length / avgWordsPerLine);
    
    // Adjust for height constraints
    const maxLinesForHeight = Math.floor(availableHeight / (baseFontSize * 1.3));
    if (estimatedLines > maxLinesForHeight) {
        baseFontSize = Math.floor(availableHeight / (estimatedLines * 1.3));
    }
    
    // Ensure minimum readable font size
    const finalFontSize = Math.max(baseFontSize, 14);
    
    // Apply the calculated font size
    quoteElement.style.fontSize = finalFontSize + 'px';
    
    // Additional adjustments for very long quotes
    if (textLength > 200) {
        quoteElement.style.lineHeight = '1.2';
        quoteElement.style.marginBottom = '20px';
    } else if (textLength > 100) {
        quoteElement.style.lineHeight = '1.25';
    }
    
    // Debug logging (remove in production)
    console.log(`Quote length: ${textLength}, Font size: ${finalFontSize}px, Estimated lines: ${estimatedLines}`);
}

// Run font adjustment when page loads
document.addEventListener('DOMContentLoaded', adjustFontSize);

// Also run on window resize (though unlikely on e-ink display)
window.addEventListener('resize', adjustFontSize);
</script>
